#include <err.h>
#include <getopt.h>
#include <libgen.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <strings.h>
#include <unistd.h>

#include "llcp_pdu.h"
#include "llc_link.h"
#include "llc_service.h"
#include "mac.h"
#include "llcp_parameters.h"
#include "llc_connection.h"

#include "snep.h"
#include "ndef.h"
#include "snep_send_thread.h"

//To enable the llcp_log_log function.
//Must be defined before the include of llcp_log.h !!!!!!!!!!!!
#define DEBUG 1

#include "llcp_log.h"

void *
snep_send_thread (void *arg) {

	llcp_log_log("[nfc-p2p-demo.c]", LLC_PRIORITY_FATAL, "[snep_send_thread] started!");
    struct llc_connection *connection = (struct llc_connection *) arg;
    uint8_t buffer[] = {0x10, 0x02, 0x00, 0x00, 0x00, 0x47, 0xd2, 0x24, 0x20, 0x61, 0x70,
    		0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x2f, 0x63, 0x6f, 0x6d, 0x2e, 0x65, 0x78, 0x61, 0x6d,
    		0x70, 0x6c, 0x65, 0x2e, 0x61, 0x6e, 0x64, 0x72, 0x6f, 0x69, 0x64, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x42, 0x65,
    		0x61, 0x6d, 0x20, 0x6d, 0x65, 0x20, 0x75, 0x70, 0x21, 0x0a, 0x0a, 0x42, 0x65, 0x61, 0x6d, 0x20, 0x54, 0x69,
    		0x6d, 0x65, 0x3a, 0x20, 0x31, 0x31, 0x3a, 0x34, 0x33, 0x3a, 0x32, 0x30
    };

    sleep (1);

    llcp_log_log("[nfc-p2p-demo.c]", LLC_PRIORITY_FATAL, "[snep_send_thread] Sending data");
    llc_connection_send (connection, buffer, sizeof (buffer));

    llc_connection_stop (connection);

    return NULL;

}

